FROM maven:3.9-eclipse-temurin-21

# Create two separate workspaces
WORKDIR /build
COPY pom.xml .
# Force download of all plugins and dependencies
RUN mvn -B spring-boot:help dependency:go-offline

# Switch to runtime workspace
WORKDIR /app
# Copy only the essential non-source files
COPY src/main/resources/application.properties ./src/main/resources/

EXPOSE 8080

CMD ["mvn", "spring-boot:run", "-Dspring-boot.run.jvmArguments=-Dspring.devtools.restart.enabled=true","-Dspring-boot.run.profiles=dev"]