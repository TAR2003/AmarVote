spring.application.name=amarvote

# Use the direct URL from environment variable
spring.datasource.url=${SPRING_DATASOURCE_URL}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# JPA/Hibernate Properties
spring.jpa.hibernate.ddl-auto=update
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.PostgreSQLDialect
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true

# Timezone Configuration - Force UTC for all database operations
spring.jpa.properties.hibernate.jdbc.time_zone=UTC

server.forward-headers-strategy=framework

deepseek.api.url=https://openrouter.ai/api/v1/chat/completions
deepseek.api.key=${DEEPSEEK_API_KEY}

# RAG Service Configuration
rag.service.url=${RAG_SERVICE_URL}

# ElectionGuard Service Configuration
electionguard.base.url=http://electionguard:5000
electionguard.connection.timeout=10000
electionguard.socket.timeout=600000
electionguard.connection.request.timeout=10000
electionguard.max.connections=50
electionguard.max.per.route=20

# Resilience4j Circuit Breaker Configuration
resilience4j.circuitbreaker.instances.electionguard.register-health-indicator=true
resilience4j.circuitbreaker.instances.electionguard.sliding-window-size=10
resilience4j.circuitbreaker.instances.electionguard.permitted-number-of-calls-in-half-open-state=3
resilience4j.circuitbreaker.instances.electionguard.automatic-transition-from-open-to-half-open-enabled=true
resilience4j.circuitbreaker.instances.electionguard.wait-duration-in-open-state=30s
resilience4j.circuitbreaker.instances.electionguard.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.electionguard.slow-call-duration-threshold=300s
resilience4j.circuitbreaker.instances.electionguard.slow-call-rate-threshold=80

# Resilience4j Retry Configuration
resilience4j.retry.instances.electionguard.max-attempts=3
resilience4j.retry.instances.electionguard.wait-duration=2s
resilience4j.retry.instances.electionguard.enable-exponential-backoff=true
resilience4j.retry.instances.electionguard.exponential-backoff-multiplier=2

# WebClient Configuration (DEPRECATED - using RestTemplate now)
webclient.buffer.size=10485760
webclient.timeout.response=300000

# spring.datasource.hikari.connectionTestQuery=SELECT 1
spring.datasource.hikari.maximum-pool-size=30
spring.datasource.hikari.minimum-idle=10
spring.datasource.hikari.connection-timeout=30000
spring.datasource.hikari.idle-timeout=600000
spring.datasource.hikari.max-lifetime=1800000
spring.datasource.hikari.leak-detection-threshold=60000

jwt.secret=${JWT_SECRET}
jwt.expiration=1800000

# Cookie Security Settings
# Set to false for local/LAN development over HTTP
# Set to true for production HTTPS deployment
cookie.secure=false

spring.mail.host=smtp.gmail.com
spring.mail.port=587
spring.mail.username=amarvote2025@gmail.com
spring.mail.password=${MAIL_PASSWORD}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true
# Bypass SSL verification (only for testing!)
spring.mail.properties.mail.smtp.ssl.trust=*
spring.mail.properties.mail.smtp.ssl.protocols=TLSv1.2

# brevo.api.key=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
# brevo.sender.email=amarvote2025@gmail.com
# brevo.sender.name=AmarVote


# Server Configuration
server.port=8080
server.address=0.0.0.0

# Async request timeout (5 minutes for computationally intensive operations)
spring.mvc.async.request-timeout=300000

# Async Execution for Chunk Processing
spring.task.execution.pool.core-size=20
spring.task.execution.pool.max-size=50
spring.task.execution.pool.queue-capacity=500
spring.task.execution.pool.keep-alive=60s
spring.task.execution.thread-name-prefix=chunk-processor-

# Multipart File Upload Configuration
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB
spring.servlet.multipart.enabled=true

# RAG Service Configuration (5 minutes timeout)
rag.service.timeout=300000


# Blockchain Service Configuration
blockchain.service.url=${BLOCKCHAIN_SERVICE_URL}

# Cloudinary Configuration
cloudinary.cloud_name=${CLOUDINARY_NAME}
cloudinary.api_key=${CLOUDINARY_KEY}
cloudinary.api_secret=${CLOUDINARY_SECRET}

# AmarVote Chunking Configuration
amarvote.chunking.chunk-size=50

# AmarVote OTP Configuration
amarvote.otp.validity-minutes=5

# AmarVote Credentials Configuration
# Directory for storing temporary credential files
# In production, use an absolute path or mounted volume
amarvote.credentials.directory=${CREDENTIALS_DIRECTORY:credentials}
# Enable secure deletion (overwrite files before deletion)
amarvote.credentials.secure-delete=true
# Maximum credential file size in MB
amarvote.credentials.max-file-size-mb=10

# Actuator & Prometheus Configuration
# Actuator & Prometheus Configuration
# Actuator & Prometheus Configuration (Spring Boot 3.5.0+)
management.endpoints.web.exposure.include=health,info,prometheus,metrics
management.prometheus.metrics.export.enabled=true
management.endpoint.health.show-details=when-authorized
management.endpoints.web.base-path=/actuator
# Add application label to metrics
management.metrics.tags.application=AmarVote Backend

# RabbitMQ Configuration (Tier 3 Message Queue)
spring.rabbitmq.host=${RABBITMQ_HOST:rabbitmq}
spring.rabbitmq.port=${RABBITMQ_PORT:5672}
spring.rabbitmq.username=${RABBITMQ_USERNAME:amarvote}
spring.rabbitmq.password=${RABBITMQ_PASSWORD:amarvote_queue_pass}
spring.rabbitmq.virtual-host=/
# Connection pool
spring.rabbitmq.connection-timeout=60000
spring.rabbitmq.requested-heartbeat=30
# Publisher confirms (reliability)
spring.rabbitmq.publisher-confirm-type=correlated
spring.rabbitmq.publisher-returns=true
# Consumer settings
spring.rabbitmq.listener.simple.acknowledge-mode=auto
spring.rabbitmq.listener.simple.prefetch=1
spring.rabbitmq.listener.simple.concurrency=1
spring.rabbitmq.listener.simple.max-concurrency=10
spring.rabbitmq.listener.simple.retry.enabled=true
spring.rabbitmq.listener.simple.retry.max-attempts=3

